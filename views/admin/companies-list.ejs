<!DOCTYPE html>
<html lang="vi">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
	<title>Quản lý công ty - AT Digital Card</title>

	<!-- Favicon -->
	<link rel="shortcut icon" href="/public/assets/icon.ico">

	<!-- Fonts -->
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="/public/assets/admin/plugins/bootstrap/css/bootstrap.min.css">

	<!-- Feathericon CSS -->
	<link rel="stylesheet" href="/public/assets/admin/plugins/feather/feather.css">

	<!-- Fontawesome CSS -->
	<link rel="stylesheet" href="/public/assets/admin/plugins/fontawesome/css/fontawesome.min.css">
	<link rel="stylesheet" href="/public/assets/admin/plugins/fontawesome/css/all.min.css">

	<!-- Main CSS -->
	<link rel="stylesheet" href="/public/assets/admin/css/style.css">

	<style>
		:root {
			--primary-blue: #012596;
			--accent-red: #CC0514;
			--text-dark: #1a1a2e;
			--text-muted: #6b7280;
			--bg-light: #f8faff;
			--border-color: #e5e7eb;
			--success: #10b981;
		}

		body {
			font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif !important;
			background: var(--bg-light);
		}

		.page-wrapper {
			margin-left: 240px;
			padding-top: 60px;
			transition: all 0.3s ease;
		}

		@media (max-width: 991px) {
			.page-wrapper {
				margin-left: 0;
			}
		}

		.mini-sidebar .page-wrapper {
			margin-left: 70px;
		}

		.page-header-custom {
			margin-bottom: 24px;
		}

		.page-header-custom h2 {
			font-size: 24px;
			font-weight: 700;
			color: var(--text-dark);
			margin: 0;
		}

		.page-header-custom p {
			color: var(--text-muted);
			margin: 4px 0 0;
		}

		/* Search Bar */
		.search-bar {
			display: flex;
			gap: 12px;
			margin-bottom: 24px;
			flex-wrap: wrap;
		}

		.search-bar input {
			flex: 1;
			min-width: 200px;
			max-width: 400px;
			padding: 12px 16px;
			border: 1.5px solid var(--border-color);
			border-radius: 10px;
			font-size: 14px;
			background: white;
		}

		.search-bar input:focus {
			outline: none;
			border-color: var(--primary-blue);
		}

		/* Card */
		.card-custom {
			background: white;
			border-radius: 16px;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
			border: 1px solid var(--border-color);
			overflow: hidden;
		}

		.card-header-custom {
			padding: 20px 24px;
			border-bottom: 1px solid var(--border-color);
			display: flex;
			align-items: center;
			justify-content: space-between;
			flex-wrap: wrap;
			gap: 16px;
		}

		.card-header-custom h5 {
			font-size: 16px;
			font-weight: 600;
			color: var(--text-dark);
			margin: 0;
		}

		.btn-add {
			display: inline-flex;
			align-items: center;
			gap: 8px;
			padding: 10px 18px;
			background: var(--primary-blue);
			color: white;
			border: none;
			border-radius: 10px;
			font-size: 14px;
			font-weight: 500;
			cursor: pointer;
			text-decoration: none;
		}

		.btn-add:hover {
			background: #011d78;
			color: white;
		}

		/* Table */
		.table-responsive {
			padding: 0 24px 24px;
		}

		.table {
			margin-bottom: 0;
		}

		.table thead th {
			font-size: 12px;
			font-weight: 600;
			text-transform: uppercase;
			color: var(--text-muted);
			border-bottom: 1px solid var(--border-color);
			padding: 16px 12px;
			white-space: nowrap;
		}

		.table tbody td {
			padding: 16px 12px;
			vertical-align: middle;
			border-bottom: 1px solid var(--border-color);
			color: var(--text-dark);
		}

		.table tbody tr:last-child td {
			border-bottom: none;
		}

		.company-logo {
			width: 50px;
			height: 50px;
			object-fit: contain;
			border-radius: 8px;
			background: var(--bg-light);
			padding: 4px;
		}

		.status-badge {
			padding: 6px 12px;
			border-radius: 20px;
			font-size: 12px;
			font-weight: 500;
		}

		.status-active {
			background: rgba(16, 185, 129, 0.1);
			color: var(--success);
		}

		.status-inactive {
			background: rgba(204, 5, 20, 0.1);
			color: var(--accent-red);
		}

		.btn-sm {
			padding: 6px 12px;
			font-size: 12px;
			border-radius: 8px;
		}
	</style>
</head>

<body>

	<!-- Main Wrapper -->
	<div class="main-wrapper">

		<!-- Header -->
		<%- include('header.ejs') %>
			<!-- /Header -->

			<!-- Sidebar -->
			<%- include('sidebar.ejs') %>
				<!-- /Sidebar -->

				<!-- Page Wrapper -->
				<div class="page-wrapper">
					<div class="content container-fluid">

						<!-- Page Header -->
						<div class="page-header-custom">
							<h2>Quản lý công ty</h2>
							<p>Xem và quản lý tất cả các công ty trong hệ thống</p>
						</div>

						<!-- Search Bar -->
						<div class="search-bar">
							<input type="text" id="searchCompanyInput" placeholder="Tìm theo tên công ty, email...">
						</div>

						<!-- Companies Table -->
						<div class="card-custom">
							<div class="card-header-custom">
								<h5><i class="fas fa-building me-2"></i>Danh sách công ty</h5>
								<a href="/add-company" class="btn-add">
									<i class="fas fa-plus"></i>
									Thêm công ty
								</a>
							</div>

							<div class="table-responsive">
								<table class="table">
									<thead>
										<tr>
											<th>STT</th>
											<th>Tên công ty</th>
											<th>Logo</th>
											<th>Email CEO</th>
											<th>Trạng thái</th>
											<th class="text-end">Hành động</th>
										</tr>
									</thead>
									<tbody>
										<% companies.forEach((company, index)=> { %>
											<tr class="company-row">
												<td>
													<%= index + 1 %>
												</td>
												<td><strong>
														<%= company.name %>
													</strong></td>
												<td>
													<img src="<%= company.logo %>" alt="Logo" class="company-logo">
												</td>
												<td>
													<%= company.ceo.email %>
												</td>
												<td>
													<span
														class="status-badge <%= company.status===1 ? 'status-active' : 'status-inactive' %>">
														<%= company.status===1 ? 'Đang hoạt động' : 'Ngừng hoạt động' %>
													</span>
												</td>
												<td class="text-end">
													<div class="d-flex gap-2 justify-content-end">
														<button
															onclick="updateCompanyStatus('<%= company._id %>', this.getAttribute('data-action'))"
															data-action='<%= company.status === 1 ? "deactivate" : "activate" %>'
															class="btn btn-sm btn-outline-primary">
															<%= company.status===1 ? 'Tắt hoạt động' : 'Kích hoạt' %>
														</button>
														<form action="/delete-company/<%= company._id %>" method="POST"
															style="display: inline-block;"
															onsubmit="return confirm('CẢNH BÁO: Xóa công ty này sẽ xóa TẤT CẢ nhân viên và tài khoản CEO liên quan. Tiếp tục?');">
															<button type="submit" class="btn btn-sm btn-danger">
																<i class="fas fa-trash"></i> Xóa
															</button>
														</form>
													</div>
												</td>
											</tr>
											<% }); %>
									</tbody>
								</table>
							</div>
						</div>

					</div>
				</div>
				<!-- /Page Wrapper -->

	</div>
	<!-- /Main Wrapper -->

	<!-- jQuery -->
	<script src="/public/assets/admin/js/jquery-3.6.0.min.js"></script>

	<!-- Bootstrap Core JS -->
	<script src="/public/assets/admin/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>

	<!-- Feather Icon JS -->
	<script src="/public/assets/admin/js/feather.min.js"></script>

	<!-- Custom JS -->
	<script src="/public/assets/admin/js/script.js"></script>

	<script>
		function updateCompanyStatus(companyId, action) {
			fetch(`/update-company-status/${companyId}`, {
				method: 'PUT',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify({ action }),
			})
				.then(response => response.json())
				.then(data => {
					console.log(data);
					window.location.reload();
				})
				.catch(error => console.error(error));
		}

		$(document).ready(function () {
			function filterCompanies(query) {
				query = query.toLowerCase();
				$('.company-row').hide();
				$('.company-row').each(function () {
					var rowData = $(this).text().toLowerCase();
					if (rowData.indexOf(query) !== -1) {
						$(this).show();
					}
				});
			}

			$('#searchCompanyInput').on('input', function () {
				var searchQuery = $(this).val();
				filterCompanies(searchQuery);
			});
		});
	</script>
</body>

</html>