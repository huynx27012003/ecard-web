<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <% const getVal=(name, fallback='' )=> {
        if (typeof selectedItem !== 'undefined' && selectedItem && selectedItem.templateFields) {
        const field = selectedItem.templateFields.find(f => f.fieldName === name);
        if (field && field.fieldValue) return field.fieldValue;
        }
        return fallback;
        };
        const stName = getVal('Name', user.username);
        const stRole = getVal('Role');
        const stEmail = getVal('ContactEmail', user.email);
        const stPhone1 = getVal('Phone1', user.number);
        const stPhone2 = getVal('Phone2');
        const stAddress = getVal('Address');
        const stCompany = getVal('Company');
        const stURL = getVal('URL');
        const stVideo = getVal('VideoURL');
        const stColor = (typeof selectedItem !== 'undefined' && selectedItem && selectedItem.bgColor) ?
        selectedItem.bgColor : '#012596';
        const stImage = (typeof selectedItem !== 'undefined' && selectedItem && selectedItem.Image) ? selectedItem.Image
        : '';
        %>
        <title>Thiết Kế Danh Thiếp - AT Digital Card</title>
        <link rel="shortcut icon" href="/public/assets/icon.ico">
        <link rel="stylesheet" href="/public/assets/admin/plugins/bootstrap/css/bootstrap.min.css">
        <link rel="stylesheet" href="/public/assets/admin/plugins/fontawesome/css/fontawesome.min.css">
        <link rel="stylesheet" href="/public/assets/admin/plugins/fontawesome/css/all.min.css">
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="/public/assets/admin/css/style.css">

        <style>
            :root {
                --primary-blue: #012596;
                --primary-blue-dark: #011d78;
                --primary-blue-light: #1a3db8;
                --accent-red: #CC0514;
                --text-dark: #1a1a2e;
                --text-muted: #6b7280;
                --bg-light: #f8faff;
                --border-color: #e5e7eb;
                --success: #10b981;
            }

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
                background: var(--bg-light);
                min-height: 100vh;
            }

            /* Main Content Area */
            .page-wrapper {
                margin-left: 240px;
                padding-top: 60px;
                min-height: 100vh;
                transition: all 0.3s ease;
            }

            .mini-sidebar .page-wrapper {
                margin-left: 70px;
            }

            @media (max-width: 991px) {
                .page-wrapper {
                    margin-left: 0;
                }
            }

            /* Studio Layout */
            .studio-container {
                display: flex;
                height: calc(100vh - 60px);
                overflow: hidden;
            }

            /* Editor Panel */
            .editor-panel {
                width: 380px;
                background: white;
                border-right: 1px solid var(--border-color);
                display: flex;
                flex-direction: column;
                overflow: hidden;
                flex-shrink: 0;
            }

            .editor-header {
                padding: 16px 20px;
                border-bottom: 1px solid var(--border-color);
                display: flex;
                align-items: center;
                justify-content: space-between;
            }

            .editor-header h2 {
                font-size: 16px;
                font-weight: 600;
                color: var(--text-dark);
                margin: 0;
            }

            .template-badge {
                padding: 6px 12px;
                background: var(--bg-light);
                border: 1px solid var(--border-color);
                border-radius: 6px;
                font-size: 12px;
                color: var(--text-muted);
            }

            .editor-scroll {
                flex: 1;
                overflow-y: auto;
                padding: 20px;
            }

            .section-title {
                display: flex;
                align-items: center;
                gap: 10px;
                font-size: 14px;
                font-weight: 600;
                color: var(--text-dark);
                margin-bottom: 16px;
                padding-bottom: 12px;
                border-bottom: 1px solid var(--border-color);
            }

            .section-title i {
                color: var(--primary-blue);
            }

            .form-group {
                margin-bottom: 16px;
            }

            .form-label {
                display: block;
                font-size: 12px;
                font-weight: 600;
                color: var(--text-muted);
                margin-bottom: 6px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .form-control {
                width: 100%;
                padding: 12px 14px;
                font-size: 14px;
                border: 1.5px solid var(--border-color);
                border-radius: 10px;
                transition: all 0.2s ease;
                background: var(--bg-light);
            }

            .form-control:focus {
                outline: none;
                border-color: var(--primary-blue);
                background: white;
                box-shadow: 0 0 0 4px rgba(1, 37, 150, 0.1);
            }

            .form-row {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }

            /* Color Picker */
            .color-picker-wrapper {
                display: flex;
                align-items: center;
                gap: 12px;
            }

            .color-picker-wrapper input[type="color"] {
                width: 48px;
                height: 48px;
                padding: 0;
                border: 2px solid var(--border-color);
                border-radius: 10px;
                cursor: pointer;
            }

            /* File Input */
            .file-input-wrapper {
                position: relative;
            }

            .file-input-wrapper input[type="file"] {
                position: absolute;
                opacity: 0;
                width: 100%;
                height: 100%;
                cursor: pointer;
            }

            .file-input-label {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                padding: 14px;
                background: var(--bg-light);
                border: 2px dashed var(--border-color);
                border-radius: 10px;
                font-size: 13px;
                color: var(--text-muted);
                transition: all 0.2s ease;
                cursor: pointer;
            }

            .file-input-wrapper:hover .file-input-label {
                border-color: var(--primary-blue);
                background: rgba(1, 37, 150, 0.02);
            }

            /* Submit Button */
            .editor-footer {
                padding: 16px 20px;
                background: white;
                border-top: 1px solid var(--border-color);
            }

            .btn-save {
                width: 100%;
                padding: 16px;
                background: var(--primary-blue);
                color: white;
                border: none;
                border-radius: 12px;
                font-size: 15px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
            }

            .btn-save:hover {
                background: var(--primary-blue-dark);
                transform: translateY(-2px);
                box-shadow: 0 8px 20px rgba(1, 37, 150, 0.3);
            }

            /* Preview Panel */
            .preview-panel {
                flex: 1;
                background: linear-gradient(135deg, #e8ecf4 0%, #f8faff 100%);
                display: flex;
                align-items: flex-start;
                justify-content: center;
                padding: 40px;
                overflow-y: auto;
            }

            /* Card Preview */
            .card-preview {
                width: 360px;
                background: white;
                border-radius: 24px;
                box-shadow: 0 20px 50px rgba(0, 0, 0, 0.1);
                overflow: hidden;
            }

            .card-cover {
                width: 100%;
                height: 280px;
                background-color: #ddd;
                background-repeat: no-repeat;
                background-size: cover;
                background-position: center 50%;
                position: relative;
            }

            .card-cover::after {
                content: "";
                position: absolute;
                bottom: 0;
                width: 100%;
                height: 80px;
                background: linear-gradient(to top, white, transparent);
            }

            .card-info-box {
                background: var(--primary-blue);
                color: white;
                border-radius: 16px;
                padding: 20px;
                margin: -50px 20px 20px;
                position: relative;
                z-index: 2;
                box-shadow: 0 8px 24px rgba(1, 37, 150, 0.25);
            }

            .card-name {
                font-size: 20px;
                font-weight: 700;
                margin-bottom: 4px;
            }

            .card-role {
                font-size: 13px;
                opacity: 0.9;
                margin-bottom: 4px;
            }

            .card-company {
                font-size: 12px;
                opacity: 0.7;
            }

            .card-contacts {
                padding: 0 20px 20px;
            }

            .contact-item {
                display: flex;
                align-items: center;
                gap: 12px;
                background: var(--bg-light);
                padding: 12px 14px;
                border-radius: 10px;
                margin-bottom: 8px;
                font-size: 13px;
                color: var(--text-dark);
            }

            .contact-icon {
                width: 32px;
                height: 32px;
                border-radius: 8px;
                background: white;
                display: flex;
                align-items: center;
                justify-content: center;
                color: var(--primary-blue);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            }

            /* Live Preview - Match public-card design */
            .card-preview {
                width: 360px;
                background: white;
                border-radius: 20px;
                box-shadow: 0 25px 60px rgba(0, 0, 0, 0.15);
                overflow: hidden;
                font-family: 'Be Vietnam Pro', sans-serif;
            }

            .preview-hero {
                position: relative;
                background: linear-gradient(180deg, #2344af 0%, #326eb8 50%);
                min-height: 200px;
                overflow: hidden;
            }

            .preview-key-visual {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 200px;
                height: 200px;
                background-image: url('/public/uploads/company_logo/AT Energy_Key visual.png');
                background-size: contain;
                background-repeat: no-repeat;
                background-position: center;
                opacity: 0.5;
            }

            .preview-photo {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: transparent;
                background-repeat: no-repeat;
                background-size: cover;
                background-position: center 50%;
                z-index: 3;
            }

            .preview-wave {
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                height: 50px;
                z-index: 5;
            }

            .preview-wave svg {
                width: 100%;
                height: 100%;
                display: block;
            }

            .preview-logo {
                position: absolute;
                bottom: 10px;
                right: 15px;
                width: 100px;
                height: auto;
                z-index: 6;
            }

            .preview-card-info {
                background: linear-gradient(135deg, #2344af 0%, #326eb8 100%);
                margin: 10px 15px;
                border-radius: 12px;
                padding: 18px 16px;
                color: white;
                box-shadow: 0 8px 25px rgba(35, 68, 175, 0.3);
            }

            .preview-name {
                font-size: 18px;
                font-weight: 700;
                margin-bottom: 4px;
            }

            .preview-role {
                font-size: 12px;
                opacity: 0.9;
                margin-bottom: 2px;
            }

            .preview-company {
                font-size: 11px;
                opacity: 0.75;
                margin-bottom: 12px;
            }

            .preview-actions {
                display: flex;
                justify-content: center;
                gap: 10px;
            }

            .preview-action {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 18px;
            }

            .preview-action.filled {
                background: white;
                color: #2344af;
            }

            .preview-action.outline {
                background: transparent;
                border: 2px solid rgba(255, 255, 255, 0.5);
                color: white;
            }

            .preview-contacts {
                padding: 10px 15px;
            }

            .preview-contact {
                display: flex;
                align-items: center;
                gap: 10px;
                background: linear-gradient(135deg, #2344af 0%, #326eb8 100%);
                padding: 10px 12px;
                border-radius: 8px;
                color: white;
                font-size: 11px;
                margin-bottom: 6px;
            }

            .preview-contact i {
                font-size: 14px;
                opacity: 0.9;
            }

            .open-card-link {
                display: block;
                text-align: center;
                padding: 12px;
                background: var(--primary-blue);
                color: white;
                text-decoration: none;
                font-size: 13px;
                font-weight: 500;
                transition: background 0.2s;
            }

            .open-card-link:hover {
                background: var(--primary-blue-dark);
                color: white;
            }

            /* Mobile Responsive */
            @media (max-width: 1200px) {
                .studio-container {
                    flex-direction: column;
                    height: auto;
                }

                .editor-panel {
                    width: 100%;
                    border-right: none;
                    border-bottom: 1px solid var(--border-color);
                }

                .preview-panel {
                    padding: 24px;
                    min-height: 60vh;
                }

                .card-preview {
                    width: 100%;
                    max-width: 360px;
                }
            }

            @media (max-width: 480px) {
                .editor-scroll {
                    padding: 16px;
                }

                .form-row {
                    grid-template-columns: 1fr;
                }
            }
        </style>
</head>

<body>
    <div class="main-wrapper">
        <!-- Header -->
        <%- include('../admin/header.ejs') %>

            <!-- Sidebar -->
            <%- include('../admin/sidebar.ejs') %>

                <!-- Page Wrapper -->
                <div class="page-wrapper">
                    <div class="studio-container">
                        <!-- Editor Panel -->
                        <div class="editor-panel">
                            <div class="editor-header">
                                <h2><i class="fas fa-paint-brush me-2"></i>Card Studio</h2>
                                <span class="template-badge">
                                    <%= template.name==='profsample-1' ? 'AT Energy Professional' : template.name %>
                                </span>
                            </div>

                            <!-- Stats Card -->
                            <div class="stats-card"
                                style="background: linear-gradient(135deg, #004b8d, #1a5fb4); color: white; padding: 16px 20px; border-radius: 12px; margin-bottom: 16px; display: flex; align-items: center; gap: 16px;">
                                <div
                                    style="width: 48px; height: 48px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-eye" style="font-size: 20px;"></i>
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-size: 24px; font-weight: 700;">
                                        <%= selectedItem.viewCount || 0 %>
                                    </div>
                                    <div style="font-size: 12px; opacity: 0.8;">Lượt xem card</div>
                                </div>
                                <% if(selectedItem.lastViewedAt) { %>
                                    <div style="text-align: right; font-size: 11px; opacity: 0.7;">
                                        Xem gần nhất<br>
                                        <%= new Date(selectedItem.lastViewedAt).toLocaleDateString('vi-VN') %>
                                    </div>
                                    <% } %>
                            </div>

                            <form action="/businesscard/<%= user._id %>" method="POST" enctype="multipart/form-data"
                                class="d-flex flex-column" style="flex: 1; overflow: hidden;">
                                <input type="hidden" name="selectedItems" value='<%= JSON.stringify(selectedItem) %>'>
                                <input type="hidden" name="existingImage" value="<%= stImage %>">
                                <input type="hidden" name="existingBgImage"
                                    value="<%= (selectedItem && selectedItem.bgImg) ? selectedItem.bgImg : '' %>">

                                <div class="editor-scroll">
                                    <!-- Personal Info Section -->
                                    <div class="section-title">
                                        <i class="fas fa-user"></i>
                                        Thông tin cá nhân
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Họ và tên</label>
                                        <input type="text" name="Name" id="inputName" class="form-control"
                                            placeholder="Nguyễn Văn A" value="<%= stName %>">
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Chức vụ</label>
                                        <input type="text" name="Role" id="inputRole" class="form-control"
                                            placeholder="Giám đốc kinh doanh" value="<%= stRole %>">
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Email liên hệ</label>
                                        <input type="email" name="ContactEmail" id="inputEmail" class="form-control"
                                            placeholder="email@atenergy.vn" value="<%= stEmail %>">
                                    </div>

                                    <!-- Contact Section -->
                                    <div class="section-title">
                                        <i class="fas fa-phone"></i>
                                        Thông tin liên hệ
                                    </div>

                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">Số di động</label>
                                            <input type="text" name="Phone1" id="inputPhone1" class="form-control"
                                                placeholder="0901 234 567" value="<%= stPhone1 %>">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Hotline / Văn phòng</label>
                                            <input type="text" name="Phone2" id="inputPhone2" class="form-control"
                                                placeholder="024 1234 5678" value="<%= stPhone2 %>">
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Địa chỉ</label>
                                        <textarea name="Address" id="inputAddress" class="form-control" rows="2"
                                            placeholder="Số nhà, Đường, Quận, Thành phố"><%= stAddress %></textarea>
                                    </div>

                                    <!-- Company Section -->
                                    <div class="section-title">
                                        <i class="fas fa-building"></i>
                                        Công ty & Website
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Tên công ty</label>
                                        <input type="text" name="Company" id="inputCompany" class="form-control"
                                            placeholder="AT Energy JSC" value="<%= stCompany %>">
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Website</label>
                                        <input type="text" name="URL" id="inputURL" class="form-control"
                                            placeholder="https://atenergy.vn" value="<%= stURL %>">
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Link Video YouTube (Embed)</label>
                                        <input type="text" name="VideoURL" id="inputVideo" class="form-control"
                                            placeholder="https://www.youtube.com/embed/..." value="<%= stVideo %>">
                                    </div>

                                    <!-- Social Media Section -->
                                    <div class="section-title">
                                        <i class="fas fa-share-alt"></i>
                                        Mạng xã hội
                                    </div>

                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label"><i class="fab fa-facebook"
                                                    style="color:#1877F2"></i> Facebook</label>
                                            <input type="text" name="facebook" class="form-control"
                                                placeholder="https://facebook.com/..."
                                                value="<%= (selectedItem.socialLinks && selectedItem.socialLinks.facebook) || '' %>">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label"><i class="fab fa-linkedin"
                                                    style="color:#0A66C2"></i> LinkedIn</label>
                                            <input type="text" name="linkedin" class="form-control"
                                                placeholder="https://linkedin.com/in/..."
                                                value="<%= (selectedItem.socialLinks && selectedItem.socialLinks.linkedin) || '' %>">
                                        </div>
                                    </div>

                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label"><i class="fas fa-comment-dots"
                                                    style="color:#0068FF"></i> Zalo</label>
                                            <input type="text" name="zalo" class="form-control"
                                                placeholder="https://zalo.me/..."
                                                value="<%= (selectedItem.socialLinks && selectedItem.socialLinks.zalo) || '' %>">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label"><i class="fab fa-tiktok"></i> TikTok</label>
                                            <input type="text" name="tiktok" class="form-control"
                                                placeholder="https://tiktok.com/@..."
                                                value="<%= (selectedItem.socialLinks && selectedItem.socialLinks.tiktok) || '' %>">
                                        </div>
                                    </div>

                                    <!-- Visual Section -->
                                    <div class="section-title">
                                        <i class="fas fa-image"></i>
                                        Hình ảnh & Màu sắc
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Ảnh đại diện / Ảnh bìa</label>
                                        <div class="file-input-wrapper">
                                            <input type="file" name="Image" id="inputImage" accept="image/*">
                                            <div class="file-input-label">
                                                <i class="fas fa-cloud-upload-alt"></i>
                                                Chọn ảnh hoặc kéo thả vào đây
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">Kiểu hiển thị ảnh</label>
                                            <select name="ImageFit" id="inputImageFit" class="form-control">
                                                <option value="cover" <%=getVal('ImageFit')==='cover' ? 'selected' : ''
                                                    %>>Phóng to</option>
                                                <option value="contain" <%=getVal('ImageFit')==='contain' ? 'selected'
                                                    : '' %>>Vừa khung</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Vị trí ảnh</label>
                                            <input type="range" name="ImagePos" id="inputImagePos" class="form-control"
                                                min="0" max="100" value="<%= getVal('ImagePos', '50') %>"
                                                style="padding: 8px;">
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Màu chủ đạo</label>
                                        <div class="color-picker-wrapper">
                                            <input type="color" name="bgColor" id="inputBGColor" value="<%= stColor %>">
                                            <span style="font-size: 13px; color: var(--text-muted);">Chọn màu cho thẻ
                                                thông tin</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="editor-footer">
                                    <button type="submit" class="btn-save">
                                        <i class="fas fa-save"></i>
                                        Lưu Danh Thiếp
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Preview Panel -->
                        <div class="preview-panel">
                            <div class="card-preview">
                                <!-- Hero Section -->
                                <div class="preview-hero" id="previewTheme">
                                    <div class="preview-key-visual"></div>
                                    <div class="preview-photo" id="previewCover"
                                        style="background-image: url('<%= stImage || '/public/assets/default-avatar-cutout.png' %>');">
                                    </div>
                                    <div class="preview-wave">
                                        <svg viewBox="0 0 500 60" preserveAspectRatio="none">
                                            <path d="M0,30 Q125,60 250,30 T500,30 L500,60 L0,60 Z" fill="white" />
                                        </svg>
                                    </div>
                                    <img class="preview-logo" src="/public/assets/AT-Energy-Logo-1024x200.png"
                                        alt="AT Energy">
                                </div>

                                <!-- Profile Card -->
                                <div class="preview-card-info" id="previewCardInfo">
                                    <div class="preview-name" id="previewName">
                                        <%= stName %>
                                    </div>
                                    <div class="preview-role" id="previewRole">
                                        <%= stRole || 'Chức vụ' %>
                                    </div>
                                    <div class="preview-company" id="previewCompany">
                                        <%= stCompany || 'Tên công ty' %>
                                    </div>
                                    <div class="preview-actions">
                                        <span class="preview-action filled"><i class="fas fa-phone"></i></span>
                                        <span class="preview-action outline"><i class="fas fa-envelope"></i></span>
                                        <span class="preview-action outline"><i class="fas fa-qrcode"></i></span>
                                    </div>
                                </div>

                                <!-- Contacts -->
                                <div class="preview-contacts">
                                    <div class="preview-contact">
                                        <i class="fas fa-phone"></i>
                                        <span id="previewPhone1">
                                            <%= stPhone1 || 'Số điện thoại' %>
                                        </span>
                                    </div>
                                    <div class="preview-contact">
                                        <i class="fas fa-envelope"></i>
                                        <span id="previewEmail">
                                            <%= stEmail || 'Email' %>
                                        </span>
                                    </div>
                                    <div class="preview-contact">
                                        <i class="fas fa-map-marker-alt"></i>
                                        <span id="previewAddress">
                                            <%= stAddress || 'Địa chỉ' %>
                                        </span>
                                    </div>
                                </div>

                                <!-- Open Link -->
                                <a href="/card/<%= user.username %>" target="_blank" class="open-card-link">
                                    <i class="fas fa-external-link-alt"></i> Mở Card thực tế
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
    </div>

    <!-- jQuery -->
    <script src="/public/assets/admin/js/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap Core JS -->
    <script src="/public/assets/admin/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Live Preview Script -->
    <script>
        // Input elements
        const inputs = {
            Name: document.getElementById('inputName'),
            Role: document.getElementById('inputRole'),
            Company: document.getElementById('inputCompany'),
            Email: document.getElementById('inputEmail'),
            Phone1: document.getElementById('inputPhone1'),
            Address: document.getElementById('inputAddress'),
            BGColor: document.getElementById('inputBGColor'),
            Image: document.getElementById('inputImage'),
            ImageFit: document.getElementById('inputImageFit'),
            ImagePos: document.getElementById('inputImagePos')
        };

        // Preview elements
        const previews = {
            Name: document.getElementById('previewName'),
            Role: document.getElementById('previewRole'),
            Company: document.getElementById('previewCompany'),
            Email: document.getElementById('previewEmail'),
            Phone1: document.getElementById('previewPhone1'),
            Address: document.getElementById('previewAddress'),
            Theme: document.getElementById('previewTheme'),
            CardInfo: document.getElementById('previewCardInfo'),
            Cover: document.getElementById('previewCover')
        };

        // Update preview on input change
        function updatePreview() {
            if (inputs.Name && previews.Name) previews.Name.innerText = inputs.Name.value || 'Họ và tên';
            if (inputs.Role && previews.Role) previews.Role.innerText = inputs.Role.value || 'Chức vụ';
            if (inputs.Company && previews.Company) previews.Company.innerText = inputs.Company.value || 'Tên công ty';
            if (inputs.Email && previews.Email) previews.Email.innerText = inputs.Email.value || 'Email';
            if (inputs.Phone1 && previews.Phone1) previews.Phone1.innerText = inputs.Phone1.value || 'Số điện thoại';
            if (inputs.Address && previews.Address) previews.Address.innerText = inputs.Address.value || 'Địa chỉ';

            // Update theme color
            if (inputs.BGColor && inputs.BGColor.value) {
                const color = inputs.BGColor.value;
                if (previews.Theme) previews.Theme.style.background = `linear-gradient(180deg, ${color} 0%, ${adjustColor(color, 20)} 50%)`;
                if (previews.CardInfo) previews.CardInfo.style.background = `linear-gradient(135deg, ${color} 0%, ${adjustColor(color, 20)} 100%)`;
                // Update contact pills
                document.querySelectorAll('.preview-contact').forEach(el => {
                    el.style.background = `linear-gradient(135deg, ${color} 0%, ${adjustColor(color, 20)} 100%)`;
                });
            }

            // Update photo fit and position
            if (previews.Cover) {
                if (inputs.ImageFit) {
                    previews.Cover.style.backgroundSize = inputs.ImageFit.value;
                }
                if (inputs.ImagePos) {
                    previews.Cover.style.backgroundPosition = `center ${inputs.ImagePos.value}%`;
                }
            }
        }

        // Adjust color brightness
        function adjustColor(hex, percent) {
            const num = parseInt(hex.replace('#', ''), 16);
            const amt = Math.round(2.55 * percent);
            const R = Math.min(255, (num >> 16) + amt);
            const G = Math.min(255, ((num >> 8) & 0x00FF) + amt);
            const B = Math.min(255, (num & 0x0000FF) + amt);
            return '#' + (0x1000000 + R * 0x10000 + G * 0x100 + B).toString(16).slice(1);
        }

        // Attach event listeners
        Object.keys(inputs).forEach(key => {
            if (inputs[key]) {
                inputs[key].addEventListener('input', updatePreview);
            }
        });

        // Image file preview
        if (inputs.Image) {
            inputs.Image.addEventListener('change', function () {
                if (this.files && this.files[0]) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        if (previews.Cover) previews.Cover.style.backgroundImage = `url(${e.target.result})`;
                    };
                    reader.readAsDataURL(this.files[0]);
                }
            });
        }

        // Sidebar toggle
        const sidebarToggle = document.getElementById('sidebarToggle');
        if (sidebarToggle) {
            sidebarToggle.addEventListener('click', () => {
                document.body.classList.toggle('mini-sidebar');
            });
        }

        // Initialize on load
        window.addEventListener('load', updatePreview);
    </script>
</body>

</html>