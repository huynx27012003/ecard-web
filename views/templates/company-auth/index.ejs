<!DOCTYPE html>
<html lang="vi">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>
		<%= employee.name %> - <%= company.name %>
	</title>
	<link rel="shortcut icon" href="/public/assets/icon.ico">
	<script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
	<link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap"
		rel="stylesheet">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

	<script>
		tailwind.config = {
			darkMode: "class",
			theme: {
				extend: {
					colors: {
						primary: "#1e3a5f",
						secondary: "#c41e3a",
						"background-light": "#ffffff",
						"background-dark": "#111827",
						"surface-light": "#f3f4f6",
						"surface-dark": "#1f2937",
					},
					fontFamily: {
						display: ["'Be Vietnam Pro'", "sans-serif"],
						body: ["'Be Vietnam Pro'", "sans-serif"],
					},
				},
			},
		};
	</script>

	<style>
		body {
			font-family: 'Be Vietnam Pro', sans-serif;
		}
	</style>
</head>

<body
	class="bg-background-light dark:bg-background-dark text-gray-800 dark:text-gray-100 min-h-screen transition-colors duration-300">
	<div
		class="mx-auto max-w-md w-full bg-background-light dark:bg-background-dark shadow-2xl min-h-screen flex flex-col relative overflow-hidden">

		<!-- Header with Profile Photo -->
		<div class="relative bg-surface-light dark:bg-surface-dark h-72 w-full transition-colors duration-300">
			<!-- Circular Profile Photo -->
			<div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 z-10 w-full flex justify-center">
				<div
					class="relative w-48 h-48 rounded-full overflow-hidden border-4 border-white dark:border-background-dark shadow-xl">
					<img alt="<%= employee.name %>" class="w-full h-full object-<%= employee.imageFit || 'cover' %>"
						style="object-position: center <%= employee.imagePos || '50' %>%;"
						src="<%= employee.photo || '/public/assets/default-avatar.png' %>">
				</div>
			</div>

			<!-- Curve Separator -->
			<div class="absolute bottom-0 w-full">
				<svg class="w-full h-auto block" preserveAspectRatio="none" viewBox="0 0 1440 320">
					<path class="text-background-light dark:text-background-dark transition-colors duration-300"
						d="M0,224L80,213.3C160,203,320,181,480,181.3C640,181,800,203,960,213.3C1120,224,1280,224,1360,224L1440,224L1440,320L1360,320C1280,320,1120,320,960,320C800,320,640,320,480,320C320,320,160,320,80,320L0,320Z"
						fill="currentColor" fill-opacity="1"></path>
				</svg>
			</div>
		</div>

		<!-- Content Area -->
		<div class="px-6 pb-24 relative z-20">

			<!-- Company Logo -->
			<div class="flex justify-center items-center mb-6 mt-2">
				<img src="<%= company.logo || '/public/assets/AT-Energy-Logo-1024x200.png' %>" alt="<%= company.name %>"
					class="h-10 object-contain">
			</div>

			<!-- Profile Card -->
			<div class="bg-primary rounded-3xl p-6 shadow-xl text-white relative overflow-hidden mt-4">
				<div class="absolute top-0 right-0 -mr-8 -mt-8 w-32 h-32 bg-white opacity-5 rounded-full blur-2xl">
				</div>

				<h1 class="text-2xl font-bold mb-1">
					<%= employee.name %>
				</h1>
				<p class="text-blue-100 font-medium mb-1">
					<%= employee.designation %>
				</p>
				<p class="text-blue-200 text-sm mb-3">- <%= company.name %>
				</p>

				<% if(employee.address) { %>
					<div class="flex items-start gap-2 text-sm text-blue-100 mb-6">
						<span class="material-icons text-sm mt-0.5">location_on</span>
						<p class="leading-snug">
							<%= employee.address %>
						</p>
					</div>
					<% } %>

						<!-- Quick Action Buttons -->
						<div class="flex items-center gap-4">
							<a href="tel:<%= employee.contact %>"
								class="w-12 h-12 bg-white rounded-full flex items-center justify-center text-primary hover:bg-gray-100 transition-colors shadow-md group">
								<span class="material-icons group-hover:scale-110 transition-transform">call</span>
							</a>
							<a href="mailto:<%= employee.email %>"
								class="w-12 h-12 bg-white rounded-full flex items-center justify-center text-primary hover:bg-gray-100 transition-colors shadow-md group">
								<span class="material-icons group-hover:scale-110 transition-transform">email</span>
							</a>
							<% if(employee.address) { %>
								<a href="https://maps.google.com/?q=<%= encodeURIComponent(employee.address) %>"
									target="_blank"
									class="w-12 h-12 bg-white rounded-full flex items-center justify-center text-primary hover:bg-gray-100 transition-colors shadow-md group">
									<span
										class="material-icons group-hover:scale-110 transition-transform">location_on</span>
								</a>
								<% } %>
									<button onclick="openQRModal()"
										class="w-12 h-12 bg-white rounded-full flex items-center justify-center text-primary hover:bg-gray-100 transition-colors shadow-md group">
										<span
											class="material-icons group-hover:scale-110 transition-transform">qr_code_2</span>
									</button>
						</div>
			</div>

			<!-- Contact Information Section -->
			<div class="mt-8">
				<div class="flex items-center gap-4 mb-4">
					<h2
						class="text-sm font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wide whitespace-nowrap">
						Thông tin liên hệ</h2>
					<div class="h-px bg-gray-200 dark:bg-gray-700 w-full"></div>
				</div>

				<div class="space-y-3">
					<% if(employee.contact) { %>
						<a href="tel:<%= employee.contact %>" class="block w-full">
							<div
								class="bg-primary hover:bg-blue-800 transition-colors text-white rounded-full py-3 px-5 flex items-center shadow-md">
								<span class="material-icons text-blue-200 mr-4">phone_iphone</span>
								<div>
									<span class="text-blue-200 text-xs block">Di động</span>
									<span class="font-medium text-sm">
										<%= employee.contact %>
									</span>
								</div>
							</div>
						</a>
						<% } %>

							<% if(employee.phone2) { %>
								<a href="tel:<%= employee.phone2 %>" class="block w-full">
									<div
										class="bg-primary hover:bg-blue-800 transition-colors text-white rounded-full py-3 px-5 flex items-center shadow-md">
										<span class="material-icons text-blue-200 mr-4">call</span>
										<div>
											<span class="text-blue-200 text-xs block">Hotline / Văn phòng</span>
											<span class="font-medium text-sm">
												<%= employee.phone2 %>
											</span>
										</div>
									</div>
								</a>
								<% } %>

									<% if(employee.email) { %>
										<a href="mailto:<%= employee.email %>" class="block w-full">
											<div
												class="bg-primary hover:bg-blue-800 transition-colors text-white rounded-full py-3 px-5 flex items-center shadow-md">
												<span class="material-icons text-blue-200 mr-4">email</span>
												<div>
													<span class="text-blue-200 text-xs block">Email</span>
													<span class="font-medium text-sm truncate">
														<%= employee.email %>
													</span>
												</div>
											</div>
										</a>
										<% } %>

											<% if(employee.address) { %>
												<a href="https://maps.google.com/?q=<%= encodeURIComponent(employee.address) %>"
													target="_blank" class="block w-full">
													<div
														class="bg-primary hover:bg-blue-800 transition-colors text-white rounded-2xl py-3 px-5 flex items-start shadow-md">
														<span
															class="material-icons text-blue-200 mr-4 mt-0.5">location_on</span>
														<div>
															<span class="text-blue-200 text-xs block">Địa chỉ</span>
															<span class="font-medium text-sm leading-snug">
																<%= employee.address %>
															</span>
														</div>
													</div>
												</a>
												<% } %>

													<% if(employee.website) { %>
														<a href="<%= employee.website %>" target="_blank"
															class="block w-full">
															<div
																class="bg-primary hover:bg-blue-800 transition-colors text-white rounded-full py-3 px-5 flex items-center shadow-md">
																<span
																	class="material-icons text-blue-200 mr-4">link</span>
																<div>
																	<span
																		class="text-blue-200 text-xs block">Website</span>
																	<span class="font-medium text-sm">
																		<%= employee.website %>
																	</span>
																</div>
															</div>
														</a>
														<% } %>
				</div>
			</div>

			<!-- Video Section -->
			<% if(employee.videoUrl) { %>
				<div class="mt-8">
					<div class="flex items-center gap-4 mb-4">
						<h2
							class="text-sm font-bold text-gray-700 dark:text-gray-300 uppercase tracking-wide whitespace-nowrap">
							Video</h2>
						<div class="h-px bg-gray-200 dark:bg-gray-700 w-full"></div>
					</div>

					<div class="relative w-full rounded-2xl overflow-hidden shadow-lg bg-black aspect-video">
						<iframe src="<%= employee.videoUrl %>" class="w-full h-full" allowfullscreen></iframe>
					</div>
				</div>
				<% } %>

					<!-- Footer -->
					<div class="text-center mt-8 text-gray-400 text-xs">
						Tạo danh thiếp số với <a href="/" class="text-primary dark:text-blue-400 font-semibold">AT
							Digital Card</a>
					</div>
		</div>

		<!-- Sticky Save Contact Bar -->
		<div
			class="fixed bottom-0 left-1/2 transform -translate-x-1/2 max-w-md w-full bg-white dark:bg-gray-900 p-3 shadow-lg z-50 flex gap-3 border-t border-gray-200 dark:border-gray-700">
			<button onclick="saveContact()"
				class="flex-1 bg-primary hover:bg-blue-800 text-white font-semibold py-3 px-4 rounded-xl flex items-center justify-center gap-2 shadow-md transition-colors">
				<span class="material-icons">person_add</span>
				LƯU LIÊN HỆ
			</button>
			<button onclick="shareCard()"
				class="bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 text-primary dark:text-white p-3 rounded-xl shadow-md transition-colors">
				<span class="material-icons">share</span>
			</button>
		</div>

		<!-- Dark Mode Toggle -->
		<button
			class="fixed bottom-20 right-4 z-50 p-3 bg-gray-800 dark:bg-white text-white dark:text-gray-800 rounded-full shadow-lg hover:scale-110 transition-transform"
			onclick="document.documentElement.classList.toggle('dark')">
			<span class="material-icons dark:hidden">dark_mode</span>
			<span class="material-icons hidden dark:block">light_mode</span>
		</button>
	</div>

	<!-- QR Modal -->
	<div id="qrModal" class="fixed inset-0 bg-black/60 z-[100] hidden items-center justify-center p-4"
		onclick="if(event.target === this) closeQRModal()">
		<div class="bg-white dark:bg-gray-800 rounded-3xl p-8 max-w-xs w-full text-center shadow-2xl">
			<h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">Quét để lưu liên hệ</h3>
			<div id="qrcode" class="flex justify-center mb-6"></div>
			<button onclick="closeQRModal()"
				class="w-full bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-800 dark:text-white py-3 px-6 rounded-xl font-medium transition-colors">
				Đóng
			</button>
		</div>
	</div>

	<!-- Scripts -->
	<script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
	<script>
		// QR Code with proper URL
		const currentPath = window.location.pathname;
		let qrHost = window.location.hostname;

		if (qrHost === 'localhost' || qrHost === '127.0.0.1') {
			qrHost = '<%= typeof serverIp !== "undefined" ? serverIp : "localhost" %>';
		}

		const qrUrl = window.location.protocol + '//' + qrHost + (window.location.port ? ':' + window.location.port : '') + currentPath;

		new QRCode(document.getElementById("qrcode"), {
			text: qrUrl,
			width: 180,
			height: 180,
			colorDark: "#004b8d",
			colorLight: "#ffffff"
		});

		function openQRModal() {
			document.getElementById('qrModal').classList.remove('hidden');
			document.getElementById('qrModal').classList.add('flex');
		}

		function closeQRModal() {
			document.getElementById('qrModal').classList.add('hidden');
			document.getElementById('qrModal').classList.remove('flex');
		}

		// Save Contact (vCard)
		function saveContact() {
			const vcard = `BEGIN:VCARD
VERSION:3.0
FN:<%= employee.name %>
ORG:<%= company.name %>
TITLE:<%= employee.designation %>
TEL;TYPE=CELL:<%= employee.contact %>
<% if(employee.phone2) { %>TEL;TYPE=WORK:<%= employee.phone2 %>
<% } %>EMAIL:<%= employee.email %>
<% if(employee.address) { %>ADR;TYPE=WORK:;;<%= employee.address %>
<% } %><% if(employee.website) { %>URL:<%= employee.website %>
<% } %>END:VCARD`;

			const blob = new Blob([vcard], { type: 'text/vcard;charset=utf-8' });
			const url = URL.createObjectURL(blob);
			const link = document.createElement('a');
			link.href = url;
			link.download = '<%= employee.name.replace(/\\s+/g, "_") %>.vcf';
			document.body.appendChild(link);
			link.click();
			document.body.removeChild(link);
			URL.revokeObjectURL(url);
		}

		// Share
		async function shareCard() {
			if (navigator.share) {
				try {
					await navigator.share({
						title: '<%= employee.name %> - <%= company.name %>',
						text: 'Xem danh thiếp số của <%= employee.name %>',
						url: window.location.href
					});
				} catch (err) {
					console.log('Share cancelled');
				}
			} else {
				navigator.clipboard.writeText(window.location.href);
				alert('Đã copy link vào clipboard!');
			}
		}
	</script>
</body>

</html>